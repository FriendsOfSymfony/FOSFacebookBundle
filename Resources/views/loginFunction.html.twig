function doFBLogin(accessToken, callbackFnc){
	$.post("{{ path('fbWriteAuthInSession') }}", {
		"accessToken" : accessToken
	}, function(response) {
		if (response.accessToken == accessToken) {
		    $.oauthpopup({
        			path : "{{ path(loginCheck) }}" + "?facebook=true",
        			callback : callbackFnc
        		});
		}
	});
}

function fbLogin(callbackFnc, notAuthCallbackFnc){
  	if (typeof (FB) != 'undefined' && FB != null) {
  		FB.getLoginStatus(function(response) {
  			if (response.status === 'connected' || response.status === 'not_authorized') {
  			  var accessToken = response.authResponse.accessToken;
  			  doFBLogin(accessToken, notAuthCallbackFnc);
  			}
  			else {
  			    $.oauthpopup({
        			path : "{{ facebook_login_url(url(loginCheck)) }}",
        			callback : callbackFnc
        		});
  			}
  		});
  	}
}